Linux就该这么学

## 第0章

当前最热门的开源许可协议：

- **GNU GPL**（**GNU General Public License** **，**GNU**通用公共许可证）**
- **BSD**（**Berkeley Software Distribution****，伯克利软件发布版）许可协议**
- **Apache**许可证版本（**Apache License Version****）**许可协议
- **MPL**（**Mozilla Public License****，**Mozilla**公共许可）****许可协议**
- **MIT**（**Massachusetts Institute of Technology****）许可协议**



区分Linux系统内核与Linux发行套件系统的不同。Linux系统内核指的是一个由Linus 
Torvalds负责维护，提供硬件抽象层、硬盘及文件系统控制及多任务功能的系统核心程序。而Linux发行套件系统是我们常说的Linux操作系统，也即是由Linux内核与各种常用软件的集合产品。



![第0章 咱们先来谈谈学习方法和红帽系统。第0章 咱们先来谈谈学习方法和红帽系统。](https://www.linuxprobe.com/wp-content/uploads/2016/03/certificate.png)



## 第1章 部署虚拟环境安装linux系统

VM虚拟机软件为用户提供了3种可选的网络模式，分别为桥接模式、NAT模式与仅主机模式。这里选择“仅主机模式”，如图1-22所示。

> **桥接模式：**相当于在物理主机与虚拟机网卡之间架设了一座桥梁，从而可以通过物理主机的网卡访问外网。
>
> **NAT模式：**让VM虚拟机的网络服务发挥路由器的作用，使得通过虚拟机软件模拟的主机可以通过物理主机访问外网，在真机中NAT虚拟机网卡对应的物理网卡是VMnet8。
>
> **仅主机模式：**仅让虚拟机内的主机与物理主机通信，不能访问外网，在真机中仅主机模式模拟网卡对应的物理网卡是VMnet1。



在生产环境中一定要让root管理员的密码足够复杂，否则系统将面临严重的安全问题。



忘记开机密码：

	开机时候进入救援模式

> ```
> mount -o remount,rw /sysroot
> chroot /sysroot
> passwd
> touch /.autorelabel
> exit
> reboot
> ```



如果想要将系统默认的运行目标修改为“多用户，无图形”模式，可直接用ln命令把多用户模式目标文件连接到/etc/systemd/system/目录：

[root@linuxprobe ~]# ln -sf  /lib/systemd/system/multi-user.target /etc/systemd/system/default.target



## 第2章 新手必须掌握的Linux命令

### 基本概念

让各种硬件设备各司其职且又能协同运行的东西就是系统内核。[Linux系统](https://www.linuxprobe.com/)的内核负责完成对硬件资源的分配、调度等管理任务。

很多图形化工具其实是调用了脚本来完成相应的工作，往往只是为了完成某种工作而设计的，缺乏Linux命令原有的灵活性及可控性。再者，图形化工具相较于Linux命令行界面会更加消耗系统资源。

![第2章 新手必须掌握的Linux命令。第2章 新手必须掌握的Linux命令。](https://www.linuxprobe.com/wp-content/uploads/2015/02/用户与Linux系统的交互.png)

Shell（也称为终端或壳）充当的是人与内核（硬件）之间的翻译官，用户把一些命令“告诉”终端，它就会调用相应的程序服务去完成某些工作。许多主流Linux系统默认使用的终端是Bash（Bourne-Again SHell）解释器。

> 1：通过上下方向键来调取过往执行过的Linux命令；
>
> 2：命令或参数仅需输入前几位就可以用Tab键补全；
>
> 3：具有强大的批处理脚本；
>
> 4：具有实用的环境变量功能。



###　如何使用命令

>  **命令名称  \[命令参数] [命令对象]**

命令对象一般是指要处理的文件、目录、用户等资源，而命令参数可以用长格式（完整的选项名称），也可以用短格式（单个字母的缩写），两者分别用--与-作为前缀。



### 如何使用man

表2-2                                            man命令中常用按键以及用途

| 按键      | 用处                               |
| --------- | ---------------------------------- |
| 空格键    | 向下翻一页                         |
| PaGe down | 向下翻一页                         |
| PaGe up   | 向上翻一页                         |
| home      | 直接前往首页                       |
| end       | 直接前往尾页                       |
| /         | 从上至下搜索某个关键词，如“/linux” |
| ?         | 从下至上搜索某个关键词，如“?linux” |
| n         | 定位到下一个搜索到的关键词         |
| N         | 定位到上一个搜索到的关键词         |
| q         | 退出帮助文档                       |

表2-3                                         man命令帮助信息的结构以及意义

| 结构名称    | 代表意义                 |
| ----------- | ------------------------ |
| NAME        | 命令的名称               |
| SYNOPSIS    | 参数的大致使用方法       |
| DESCRIPTION | 介绍说明                 |
| EXAMPLES    | 演示（附带简单说明）     |
| OVERVIEW    | 概述                     |
| DEFAULTS    | 默认的功能               |
| OPTIONS     | 具体的可用选项（带介绍） |
| ENVIRONMENT | 环境变量                 |
| FILES       | 用到的文件               |
| SEE ALSO    | 相关的资料               |
| HISTORY     | 维护历史与联系方式       |



### 常用系统工作命令

- echo命令用于在终端输出字符串或变量提取后的值，格式为“echo [字符串 | $变量]”。

- ```
  [root@linuxprobe ~]# date "+%Y-%m-%d %H:%M:%S"
  2017-08-24 16:29:12
  ```

- wget命令用于在终端中下载网络文件，格式为“wget [参数] 下载地址”。

  表2-5                                                wget命令的参数以及作用

  | 参数 | 作用                                 |
  | ---- | ------------------------------------ |
  | -b   | 后台下载模式                         |
  | -P   | 下载到指定目录                       |
  | -t   | 最大尝试次数                         |
  | -c   | 断点续传                             |
  | -p   | 下载页面内所有资源，包括图片、视频等 |
  | -r   | 递归下载                             |

- ps命令用于查看系统中的进程状态，格式为“ps [参数]”。ps命令可允许参数不加减号（-），因此可直接写成ps aux的样子。

表2-6                                                  ps命令的参数以及作用

| 参数 | 作用                               |
| ---- | ---------------------------------- |
| -a   | 显示所有进程（包括其他用户的进程） |
| -u   | 用户以及其他详细信息               |
| -x   | 显示没有控制终端的进程             |

> **R（运行）：**进程正在运行或在运行队列中等待。
>
> **S（中断）：**进程处于休眠中，当某个条件形成后或者接收到信号时，则脱离该   状态。
>
> **D（不可中断）：**进程不响应系统异步信号，即便用kill命令也不能将其中断。
>
> **Z（僵死）：**进程已经终止，但进程描述符依然存在, 直到父进程调用wait4()系统函数后将进程释放。
>
> **T（停止）：**进程收到停止信号后停止运行。

- top命令用于动态地监视进程活动与系统负载等信息，其格式为top。“强化版的Windows任务管理器”

- pidof命令用于查询某个指定服务进程的PID值，格式为 "pidof ~~\[参数]~~[服务名称]"

  每个进程的进程号码值（PID）是唯一的，因此可以通过PID来区分不同的进程。例如，可以使用如下命令来查询本机上sshd服务程序的PID：

  ```
  [root@linuxprobe ~]# pidof sshd
  2156
  ```

- kill命令用于终止某个指定PID的服务进程，格式为“kill ~~\[参数]~~[进程PID]”

- killall命令用于终止某个指定名称的服务所对应的全部进程，格式为：“killall ~~\[参数]~~[服务名称]”。

  > 通常来讲，复杂软件的服务程序会有多个进程协同为用户提供服务，如果逐个去结束这些进程会比较麻烦，此时可以使用killall命令来批量结束某个服务程序带有的全部进程。
  >
  > 如果有些命令在执行时不断地在屏幕上输出信息，影响到后续命令的输入，则可以在执行命令时在末尾添加上一个&符号，这样命令将进入系统后台来执行。

  #### 系统状态检测命令

- ifconfig命令用于获取网卡配置与网络状态等信息，格式为“ifconfig [网络设备][参数]”。

- uname命令用于查看系统内核与系统版本等信息，格式为“uname [-a]”。

  > 如果要查看当前系统版本的详细信息，则需要查看redhat-release文件，其命令以及相应的结果如下：
  >
  > ```
  > [root@linuxprobe ~]# cat /etc/redhat-release
  > Red Hat Enterprise Linux Server release 7.0 (Maipo)
  > ```

- uptime用于查看系统的负载信息，格式为uptime。

  uptime命令真的很棒，它可以显示当前系统时间、系统已运行时间、启用终端数量以及平均负载值等信息。平均负载值指的是系统在最近1分钟、5分钟、15分钟内的压力情况（下面加粗的信息部分）；负载值越低越好，尽量不要长期超过1，在生产环境中不要超过5。

  ```
  [root@linuxprobe ~]# uptime
  22:49:55 up 10 min, 2 users, load average: 0.01, 0.19, 0.18
  ```

- free用于显示当前系统中内存的使用量信息，格式为“free [-h]”。

- who用于查看当前登入主机的用户终端信息，格式为“who [参数]”。

- last命令用于查看所有系统的登录记录，格式为“last [参数]”。

  使用last命令可以查看本机的登录记录。但是，由于这些信息都是以日志文件的形式保存在系统中，因此黑客可以很容易地对内容进行篡改。千万不要单纯以该命令的输出信息而判断系统有无被恶意入侵！

- history命令用于显示历史执行过的命令，格式为“history [-c]”。

  显示出当前用户在本地计算机中执行过的最近1000条命令记录。如果觉得1000不够用，还可以自定义/etc/profile文件中的HISTSIZE变量值。使用-c参数则会清空所有的命令历史记录。使用“!编码数字”的方式来重复执行某一次的命令。历史命令会被保存到用户家目录中的.bash_history文件中。

- sosreport命令用于收集系统配置及架构信息并输出诊断文档，格式为sosreport。当Linux系统出现故障需要联系技术支持人员时使用。

### 工作目录切换

- pwd命令用于显示用户当前所处的工作目录，格式为“pwd [选项]”。
- “cd -”命令返回到上一次所处的目录; “cd ~username”切换到其他用户的家目录。
- ls命令用于显示目录中的文件信息，格式为“ls \[选项][文件] ”。

### 文本编辑命令

- cat命令用于查看纯文本文件（内容较少的），格式为“cat \[选项][文件]”。'-n':显示行号；

- more命令用于查看纯文本文件（内容较多的），格式为“more [选项]文件”。

- head命令用于查看纯文本文档的前N行，格式为“head \[选项][文件]”。

  > head -n 20, 显示头20行

- tail命令用于查看纯文本文档的后N行或持续刷新内容，格式为“tail \[选项][文件]”。

- tr命令用于替换文本文件中的字符，格式为“tr \[原始字符][目标字符]”。

  > ```
  > cat anaconda-ks.cfg | tr [a-z] [A-Z]
  > ```

- wc命令用于统计指定文本的行数、字数、字节数，格式为“wc [参数] 文本”。

  表2-10                                                   wc的参数以及作用

  | 参数 | 作用         |
  | ---- | ------------ |
  | -l   | 只显示行数   |
  | -w   | 只显示单词数 |
  | -c   | 只显示字节数 |

- stat命令用于查看文件的具体存储信息和时间等信息，格式为“stat 文件名称”。
- cut命令用于按“列”提取文本字符，格式为“cut [参数] 文本”。使用-f参数来设置需要看的列数，还需要使用-d参数来设置间隔符号。
- diff命令用于比较多个文本文件的差异，格式为“diff [参数] 文件”。

### 文件管理

- mkdir命令还可以结合-p参数来递归创建出具有嵌套叠层关系的文件目录。
- cp

表2-12                                               cp命令的参数及其作用

| 参数 | 作用                                         |
| ---- | -------------------------------------------- |
| -p   | 保留原始文件的属性                           |
| -d   | 若对象为“链接文件”，则保留该“链接文件”的属性 |
| -r   | 递归持续复制（用于目录）                     |
| -i   | 若目标文件存在则询问是否覆盖                 |
| -a   | 相当于-pdr（p、d、r为上述参数）              |

- rm命令后跟上-f参数来强制删除。另外，想要删除一个目录，需要在rm命令后面一个-r参数才可以，否则删除不掉。

- dd命令用于按照指定大小和个数的数据块来复制文件或转换文件，格式为“dd [参数]”。使用dd命令来压制出光盘镜像文件，将它变成一个可立即使用的iso镜像。

  表2-13                                               dd命令的参数及其作用

  | 参数  | 作用                 |
  | ----- | -------------------- |
  | if    | 输入的文件名称       |
  | of    | 输出的文件名称       |
  | bs    | 设置每个“块”的大小   |
  | count | 设置要复制“块”的个数 |

  > ```
  > dd if=/dev/cdrom of=RHEL-server-7.0-x86_64-LinuxProbe.Com.iso
  > ```

- file命令用于查看文件的类型，格式为“file 文件名”。

### 打包压缩与搜索

- tar命令用于对文件进行打包压缩或解压，-c参数用于创建压缩文件，-x参数用于解压文件，因此这两个参数不能同时使用。其次，-z参数指定使用Gzip格式来压缩或解压文件，-j参数指定使用bzip2格式来压缩或解压文件。用户使用时则是根据文件的后缀来决定应使用何种格式参数进行解压。在执行某些压缩或解压操作时，可能需要花费数个小时，如果屏幕一直没有输出，您一方面不好判断打包的进度情况，另一方面也会怀疑电脑死机了，因此非常推荐使用-v参数向用户不断显示压缩或解压的过程。-C参数用于指定要解压到哪个指定的目录。**-f参数特别重要，它必须放到参数的最后一位**，代表要压缩或解压的软件包名称。刘遄老师一般使用“tar -czvf 压缩包名称.tar.gz 要打包的目录”命令把指定的文件进行打包压缩；相应的解压命令为“tar -xzvf 压缩包名称.tar.gz”。

  表2-14                                               tar命令的参数及其作用

  | 参数 | 作用                   |
  | ---- | ---------------------- |
  | -c   | 创建压缩文件           |
  | -x   | 解开压缩文件           |
  | -t   | 查看压缩包内有哪些文件 |
  | -z   | 用Gzip压缩或解压       |
  | -j   | 用bzip2压缩或解压      |
  | -v   | 显示压缩或解压的过程   |
  | -f   | 目标文件名             |
  | -p   | 保留原始的权限与属性   |
  | -P   | 使用绝对路径来压缩     |
  | -C   | 指定解压到的目录       |

- grep命令用于在文本中执行关键词搜索，并显示匹配的结果，-n参数用来显示搜索到信息的行号；-v参数用于反选信息（即没有包含关键词的所有信息行）。

  表2-15                                              grep命令的参数及其作用

  | 参数 | 作用                                           |
  | ---- | ---------------------------------------------- |
  | -b   | 将可执行文件(binary)当作文本文件（text）来搜索 |
  | -c   | 仅显示找到的行数                               |
  | -i   | 忽略大小写                                     |
  | -n   | 显示行号                                       |
  | -v   | 反向选择——仅列出没有“关键词”的行。             |

- find命令用于按照指定条件来查找文件,格式为“find [查找路径] 寻找条件 操作”。“Linux系统中的一切都是文件”

  表2-16                                             find命令中的参数以及作用

  | 参数               | 作用                                                         |
  | ------------------ | ------------------------------------------------------------ |
  | -name              | 匹配名称                                                     |
  | -perm              | 匹配权限（mode为完全匹配，-mode为包含即可）                  |
  | -user              | 匹配所有者                                                   |
  | -group             | 匹配所有组                                                   |
  | -mtime -n +n       | 匹配修改内容的时间（-n指n天以内，+n指n天以前）               |
  | -atime -n +n       | 匹配访问文件的时间（-n指n天以内，+n指n天以前）               |
  | -ctime -n +n       | 匹配修改文件权限的时间（-n指n天以内，+n指n天以前）           |
  | -nouser            | 匹配无所有者的文件                                           |
  | -nogroup           | 匹配无所有组的文件                                           |
  | -newer f1 !f2      | 匹配比文件f1新但比f2旧的文件                                 |
  | --type b/d/c/p/l/f | 匹配文件类型（后面的字幕字母依次表示块设备、目录、字符设备、管道、链接文件、文本文件） |
  | -size              | 匹配文件的大小（+50KB为查找超过50KB的文件，而-50KB为查找小于50KB的文件） |
  | -prune             | 忽略某个目录                                                 |
  | -exec …… {}\;      | 后面可跟用于进一步处理搜索结果的命令（下文会有演示）         |

  ①根据文件系统层次标准（Filesystem Hierarchy Standard）协议，Linux系统中的配置文件会保存到/etc目录中（详见第6章）。如果要想获取到该目录中所有以host开头的文件列表，可以执行如下命令：

  ```
  [root@linuxprobe ~]# find /etc -name "host*" -print
  ```

  ②这里需要重点讲解一下-exec参数重要的作用。这个参数用于把find命令搜索到的结果交由紧随其后的命令作进一步处理，它十分类似于第3章将要讲解的管道符技术，并且由于find命令对参数的特殊要求，因此虽然exec是长格式形式，但依然只需要一个减号（-）。

  在整个文件系统中找出所有归属于linuxprobe用户的文件并复制到/root/findresults目录。

  该实验的重点是“-exec {}   \;”参数，其中的**{}表示find命令搜索出的每一个文件，并且命令的结尾必须是“\;”**

  >  [root@linuxprobe ~]# find / -user linuxprobe -exec cp -a {} /root/findresults/ \;